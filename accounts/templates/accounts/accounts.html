{% extends 'dashboard/base.html' %}
{% load static %}
{% block title %}Minha Conta{% endblock %}

{% block style %}
<link rel="stylesheet" href="{% static 'accounts/css/conta.css' %}">
{% endblock %}

{% block content %}

<main class="page">
  <h1 class="page__title">Meu Perfil:</h1>

  <!-- ===== Dados pessoais (editável com botão) ===== -->
  <section class="card">
    <h2 class="card__title">Dados Pessoais:</h2>

    {% if request.user.is_authenticated %}
    <form id="form-perfil" class="form-inline" method="POST" action="{% url 'atualizar_perfil' %}">
      {% csrf_token %}
      <div class="field">
        <label class="label" for="perfil-username">Login</label>
        <input class="input" id="perfil-username" name="nome_usuario" type="text" value="{{ request.user.username }}"
          disabled required />
      </div>

      <div class="field">
        <label class="label" for="perfil-email">Email</label>
        <input class="input" id="perfil-email" name="email" type="email" value="{{ request.user.email }}" disabled
          required />
      </div>

      <div class="actions-inline">
        <button id="btn-perfil-edit" class="btn btn--sm" type="button">Editar</button>
        <button id="btn-perfil-save" class="btn btn--sm btn--primary hidden" type="submit">Salvar</button>
      </div>

      {% if mensagem %}
      <p id="perfil-status" class="muted" aria-live="polite">{{ mensagem }}</p>
      {% else %}
      <p id="perfil-status" class="muted" aria-live="polite"></p>
      {% endif %}
    </form>
    {% else %}
    <p>Você precisa estar logado para ver seus dados.</p>
    {% endif %}
  </section>

  <!-- ===== Minhas Colmeias ===== -->
  <section class="accordion">
    <div class="accordion__item">
      <div class="accordion__summary">
        <span class="accordion__summary-text">
          <strong>Minhas Colmeias:</strong>
        </span>
        <a href="{% url 'minhas_colmeias' %}" class="btn btn--sm btn--primary">
          Acessar colmeias cadastradas
        </a>
      </div>
    </div>
  </section>

  <!-- ===== Meus Registros ===== -->
  <section class="accordion">
    <div class="accordion__item">
      <div class="accordion__summary">
        <span class="accordion__summary-text">
          <strong>Meus Registros:</strong>
        </span>
        <a href="{% url 'tudo_registros' %}" class="btn btn--sm btn--primary">
          Ver registros anteriores
        </a>
      </div>
    </div>
  </section>

  <!-- ===== Sair e Excluir Conta ===== -->
  <div class="account-actions" style="display:flex; justify-content:center; gap:20px; margin-top:30px;">
    <!-- Sair da conta -->
    <form method="POST" action="{% url 'logout' %}">
      {% csrf_token %}
      <button type="submit" class="btn btn--danger">Sair da conta</button>
    </form>

    <!-- Excluir conta -->
    <form id="form-excluir-conta" method="POST" action="{% url 'excluir_conta' %}">
      {% csrf_token %}
      <button type="submit" class="btn btn--danger">Excluir minha conta</button>
    </form>

</main>

<!-- FOOTER -->
<footer>

</footer>


<script src="{% static 'accounts/js/conta.js' %}"></script>

{% endblock %}